---
page_title: "{{.Name}} {{.Type}} - {{.ProviderName}}"
subcategory: ""
description: |-
{{ .Description | plainmarkdown | trimspace | prefixlines "  " }}
---

# {{.Name}} ({{.Type}})

{{ .Description | plainmarkdown | trimspace | prefixlines "  " }}

## Example Usage

### Basic Apache CloudStack Cluster

```terraform
data "spectrocloud_cloudaccount_apache_cloudstack" "account" {
  name = "apache-cloudstack-account-1"
}

data "spectrocloud_cluster_profile" "profile" {
  name = "cloudstack-k8s-profile"
}

resource "spectrocloud_cluster_apache_cloudstack" "cluster" {
  name             = "apache-cloudstack-cluster-1"
  tags             = ["dev", "cloudstack", "department:engineering"]
  cloud_account_id = data.spectrocloud_cloudaccount_apache_cloudstack.account.id

  cloud_config {
    ssh_key_name = "my-ssh-key"
    
    zone {
      name = "Zone1"
      
      network {
        id   = "network-id"  # or use name instead
        name = "DefaultNetwork"
      }
    }
  }

  cluster_profile {
    id = data.spectrocloud_cluster_profile.profile.id
  }

  # Control Plane Pool
  machine_pool {
    control_plane           = true
    control_plane_as_worker = true
    name                    = "cp-pool"
    count                   = 1
    offering                = "Medium Instance"  # CloudStack compute offering

    network {
      network_name = "DefaultNetwork"
    }

    additional_labels = {
      "role" = "control-plane"
    }
  }

  # Worker Pool
  machine_pool {
    name     = "worker-pool"
    count    = 2
    offering = "Large Instance"  # CloudStack compute offering

    network {
      network_name = "DefaultNetwork"
    }

    additional_labels = {
      "role" = "worker"
    }
  }
}
```

### Apache CloudStack Cluster with Advanced Configuration

```terraform
data "spectrocloud_cloudaccount_apache_cloudstack" "account" {
  name = "apache-cloudstack-account-1"
}

data "spectrocloud_cluster_profile" "profile" {
  name = "cloudstack-k8s-profile"
}

data "spectrocloud_backup_storage_location" "bsl" {
  name = "s3-backup-location"
}

resource "spectrocloud_cluster_apache_cloudstack" "advanced_cluster" {
  name             = "apache-cloudstack-production"
  tags             = ["prod", "cloudstack", "department:platform"]
  cloud_account_id = data.spectrocloud_cloudaccount_apache_cloudstack.account.id

  # Update all worker pools simultaneously for faster updates
  update_worker_pools_in_parallel = true

  cloud_config {
    ssh_key_name = "production-ssh-key"
    
    # Optional: Specify CloudStack project
    project {
      id   = "project-uuid"        # CloudStack project ID
      name = "ProductionProject"   # CloudStack project name
    }
    
    zone {
      name = "Zone1"
      
      network {
        id   = "network-id"
        name = "ProductionNetwork"
      }
    }
  }

  cluster_profile {
    id = data.spectrocloud_cluster_profile.profile.id

    # Override cluster profile variables
    variables = {
      "cluster_size" = "large"
      "environment"  = "production"
    }
  }

  # Backup Policy
  backup_policy {
    schedule                  = "0 2 * * *"  # Daily at 2 AM
    backup_location_id        = data.spectrocloud_backup_storage_location.bsl.id
    prefix                    = "cloudstack-prod-backup"
    expiry_in_hour            = 7200  # 300 days
    include_disks             = true
    include_cluster_resources = true
  }

  # Scan Policy
  scan_policy {
    configuration_scan_schedule = "0 0 * * SUN"
    penetration_scan_schedule   = "0 0 * * SUN"
    conformance_scan_schedule   = "0 0 1 * *"
  }

  # Control Plane Pool with Custom Instance Configuration
  machine_pool {
    control_plane           = true
    control_plane_as_worker = true
    name                    = "cp-pool"
    count                   = 3

    placement {
      zone         = "Zone1"
      compute      = "Medium Instance"
      network_name = "ProductionNetwork"
    }

    # Custom instance configuration
    instance_config {
      disk_gib   = 100
      memory_mib = 8192
      num_cpus   = 4
    }

    additional_labels = {
      "role"        = "control-plane"
      "environment" = "production"
    }

    taints {
      key    = "master"
      value  = "true"
      effect = "NoSchedule"
    }
  }

  # Worker Pool with Autoscaling
  machine_pool {
    name = "worker-pool-autoscale"
    count = 3
    min  = 2
    max  = 10

    placement {
      zone         = "Zone1"
      compute      = "Large Instance"
      network_name = "ProductionNetwork"
    }

    instance_config {
      disk_gib   = 200
      memory_mib = 16384
      num_cpus   = 8
    }

    additional_labels = {
      "role"        = "worker"
      "scalable"    = "true"
      "environment" = "production"
    }

    # Optional: Additional annotations for worker pool nodes
    additional_annotations = {
      "custom.io/annotation"                        = "production-workload"
      "cluster-autoscaler.kubernetes.io/enabled"    = "true"
    }

    # Optional: Override kubeadm configuration for worker nodes
    # This is only supported for worker pools (not control plane)
    override_kubeadm_configuration = <<-EOT
      kubeletExtraArgs:
        node-labels: "env=production,tier=backend"
        max-pods: "110"
      preKubeadmCommands:
        - echo 'Starting node customization'
        - sysctl -w net.ipv4.ip_forward=1
      postKubeadmCommands:
        - echo 'Node customization complete'
        - systemctl restart kubelet
    EOT

    update_strategy      = "RollingUpdateScaleOut"
    node_repave_interval = 90
  }

  timeouts {
    create = "45m"
    update = "45m"
    delete = "30m"
  }
}
```

### Apache CloudStack Cluster with Static IP Pool

```terraform
data "spectrocloud_cloudaccount_apache_cloudstack" "account" {
  name = "apache-cloudstack-account-1"
}

data "spectrocloud_cluster_profile" "profile" {
  name = "cloudstack-k8s-profile"
}

resource "spectrocloud_cluster_apache_cloudstack" "cluster_static_ip" {
  name             = "apache-cloudstack-static-ip"
  tags             = ["prod", "static-ip"]
  cloud_account_id = data.spectrocloud_cloudaccount_apache_cloudstack.account.id

  cloud_config {
    ssh_key_name = "prod-ssh-key"
    
    zone {
      name = "Zone1"
      
      network {
        id   = "network-id"
        name = "StaticIPNetwork"
      }
    }
  }

  cluster_profile {
    id = data.spectrocloud_cluster_profile.profile.id
  }

  machine_pool {
    control_plane           = true
    control_plane_as_worker = true
    name                    = "cp-pool"
    count                   = 1

    placement {
      zone              = "Zone1"
      compute           = "Medium Instance"
      network_name      = "StaticIPNetwork"
      static_ip_pool_id = "static-ip-pool-uuid"
    }
  }

  machine_pool {
    name  = "worker-pool"
    count = 2

    placement {
      zone              = "Zone1"
      compute           = "Large Instance"
      network_name      = "StaticIPNetwork"
      static_ip_pool_id = "static-ip-pool-uuid"
    }
  }
}
```

### Apache CloudStack Cluster with Template Override

```terraform
data "spectrocloud_cloudaccount_apache_cloudstack" "account" {
  name = "apache-cloudstack-account-1"
}

data "spectrocloud_cluster_profile" "profile" {
  name = "cloudstack-k8s-profile"
}

resource "spectrocloud_cluster_apache_cloudstack" "cluster_custom_template" {
  name             = "apache-cloudstack-custom-template"
  tags             = ["dev", "custom-os"]
  cloud_account_id = data.spectrocloud_cloudaccount_apache_cloudstack.account.id

  cloud_config {
    ssh_key_name = "dev-ssh-key"
    
    zone {
      name = "Zone1"
      
      network {
        id   = "network-id"
        name = "DefaultNetwork"
      }
    }
  }

  cluster_profile {
    id = data.spectrocloud_cluster_profile.profile.id
  }

  machine_pool {
    control_plane           = true
    control_plane_as_worker = true
    name                    = "cp-pool"
    count                   = 1

    placement {
      zone         = "Zone1"
      compute      = "Medium Instance"
      network_name = "DefaultNetwork"
    }

    # Override CloudStack template for this machine pool
    template {
      name = "ubuntu-22.04-custom-template"
    }
  }

  machine_pool {
    name  = "worker-pool"
    count = 2

    placement {
      zone         = "Zone1"
      compute      = "Large Instance"
      network_name = "DefaultNetwork"
    }

    # Different template for worker nodes
    template {
      name = "ubuntu-22.04-gpu-template"
    }

    instance_config {
      disk_gib   = 500
      memory_mib = 32768
      num_cpus   = 16
    }
  }
}
```

### Apache CloudStack Cluster with Cluster Template

This example shows how to create a cluster using a cluster template instead of a cluster profile. Cluster templates provide a standardized way to deploy clusters with predefined configurations.

```terraform
data "spectrocloud_cloudaccount_apache_cloudstack" "account" {
  name = "apache-cloudstack-account-1"
}

data "spectrocloud_cluster_config_template" "template" {
  name = "apache-cloudstack-standard-template"
}

resource "spectrocloud_cluster_apache_cloudstack" "cluster_from_template" {
  name             = "apache-cloudstack-template-cluster"
  tags             = ["prod", "template"]
  cloud_account_id = data.spectrocloud_cloudaccount_apache_cloudstack.account.id

  cloud_config {
    ssh_key_name = "prod-ssh-key"
    
    zone {
      name = "Zone1"
      
      network {
        id   = "network-id"
        name = "ProductionNetwork"
      }
    }
  }

  # Use cluster_template instead of cluster_profile
  cluster_template {
    id = data.spectrocloud_cluster_config_template.template.id

    # Optional: Override variables for specific profiles in the template
    cluster_profile {
      id = "profile-uid-1"
      variables = {
        "k8s_version" = "1.28.0"
        "replicas"    = "3"
      }
    }

    cluster_profile {
      id = "profile-uid-2"
      variables = {
        "namespace" = "production"
      }
    }
  }

  machine_pool {
    control_plane           = true
    control_plane_as_worker = true
    name                    = "cp-pool"
    count                   = 3
    offering                = "Large Instance"

    network {
      network_name = "ProductionNetwork"
    }
  }

  machine_pool {
    name     = "worker-pool"
    count    = 5
    min      = 3
    max      = 10
    offering = "XLarge Instance"

    network {
      network_name = "ProductionNetwork"
    }

    additional_labels = {
      "workload" = "production"
      "tier"     = "backend"
    }

    # Optional: Additional annotations
    additional_annotations = {
      "team.company.io/owner" = "platform-engineering"
    }
    
    update_strategy = "RollingUpdateScaleOut"
  }
}
```

### Apache CloudStack Cluster with Kubeadm Configuration Override

This example demonstrates how to customize kubeadm configuration for worker nodes. This is useful for setting custom kubelet arguments, running pre/post kubeadm commands, and other node-level customizations.

```terraform
data "spectrocloud_cloudaccount_apache_cloudstack" "account" {
  name = "apache-cloudstack-account-1"
}

data "spectrocloud_cluster_profile" "profile" {
  name = "cloudstack-k8s-profile"
}

resource "spectrocloud_cluster_apache_cloudstack" "cluster_custom_kubeadm" {
  name             = "apache-cloudstack-custom-kubeadm"
  tags             = ["prod", "customized"]
  cloud_account_id = data.spectrocloud_cloudaccount_apache_cloudstack.account.id

  cloud_config {
    ssh_key_name = "prod-ssh-key"
    
    zone {
      name = "Zone1"
      
      network {
        id   = "network-id"
        name = "ProductionNetwork"
      }
    }
  }

  cluster_profile {
    id = data.spectrocloud_cluster_profile.profile.id
  }

  machine_pool {
    control_plane           = true
    control_plane_as_worker = false
    name                    = "cp-pool"
    count                   = 3

    placement {
      zone         = "Zone1"
      compute      = "Large Instance"
      network_name = "ProductionNetwork"
    }

    additional_labels = {
      "role" = "control-plane"
    }
  }

  # Worker pool with custom kubeadm configuration
  machine_pool {
    name  = "worker-pool-frontend"
    count = 3

    placement {
      zone         = "Zone1"
      compute      = "XLarge Instance"
      network_name = "ProductionNetwork"
    }

    additional_labels = {
      "role" = "worker"
      "tier" = "frontend"
    }

    additional_annotations = {
      "custom.io/workload-type" = "web-facing"
    }

    # Customize kubeadm configuration for this worker pool
    # Note: override_kubeadm_configuration is only supported for worker pools
    override_kubeadm_configuration = <<-EOT
      kubeletExtraArgs:
        node-labels: "tier=frontend,zone=dmz"
        max-pods: "110"
        eviction-hard: "memory.available<500Mi,nodefs.available<10%"
        feature-gates: "RotateKubeletServerCertificate=true"
      preKubeadmCommands:
        - echo 'Configuring frontend worker node'
        - sysctl -w net.core.somaxconn=32768
        - sysctl -w net.ipv4.ip_local_port_range="1024 65535"
        - sysctl -w net.ipv4.tcp_tw_reuse=1
      postKubeadmCommands:
        - echo 'Frontend worker node setup complete'
        - systemctl restart kubelet
    EOT

    update_strategy      = "RollingUpdateScaleOut"
    node_repave_interval = 60  # Repave nodes every 60 days
  }

  # Worker pool for backend services
  machine_pool {
    name  = "worker-pool-backend"
    count = 5
    min   = 3
    max   = 10

    placement {
      zone         = "Zone1"
      compute      = "XXLarge Instance"
      network_name = "ProductionNetwork"
    }

    instance_config {
      disk_gib   = 500
      memory_mib = 65536
      num_cpus   = 16
    }

    additional_labels = {
      "role" = "worker"
      "tier" = "backend"
    }

    additional_annotations = {
      "custom.io/workload-type"                     = "backend-services"
      "cluster-autoscaler.kubernetes.io/enabled"    = "true"
    }

    # Different kubeadm configuration for backend workers
    override_kubeadm_configuration = <<-EOT
      kubeletExtraArgs:
        node-labels: "tier=backend,compute=high"
        max-pods: "200"
        kube-reserved: "cpu=1,memory=2Gi,ephemeral-storage=1Gi"
        system-reserved: "cpu=500m,memory=1Gi,ephemeral-storage=1Gi"
      preKubeadmCommands:
        - echo 'Configuring backend worker node'
        - sysctl -w vm.max_map_count=262144
        - sysctl -w fs.file-max=2097152
      postKubeadmCommands:
        - echo 'Backend worker node setup complete'
    EOT

    update_strategy      = "RollingUpdateScaleIn"
    node_repave_interval = 90
  }

  timeouts {
    create = "60m"
    update = "60m"
    delete = "30m"
  }
}
```

{{ .SchemaMarkdown | trimspace }}

